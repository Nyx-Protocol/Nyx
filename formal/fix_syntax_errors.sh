#!/bin/bash
# TLA+モジュールの一般的な構文エラーを一括修正

cd "$(dirname "$0")"

echo "TLA+ 構文エラー一括修正"
echo "======================"

# すべての.tlaファイルに対して処理
for file in *.tla; do
    if [ -f "$file" ]; then
        echo "処理中: $file"
        
        # バックアップ作成
        cp "$file" "${file}.bak"
        
        # 一般的なエラーパターンを修正
        
        # 1. 演算子の優先順位問題: * と / または \div の組み合わせ
        sed -i -E 's/([a-zA-Z_][a-zA-Z0-9_]*) \* ([0-9]+) \/ /(\1 * \2) \/ /g' "$file"
        sed -i -E 's/([a-zA-Z_][a-zA-Z0-9_]*) \* ([0-9]+) \\div /(\ 1 * \2) \\div /g' "$file"
        
        # 2. LET内の不正なカンマを削除
        # (これは複雑なので、手動修正が必要)
        
        # 3. 空の括弧() を削除 (ただし関数定義ではない場所)
        # (これも複雑なので、手動修正が必要)
    fi
done

echo ""
echo "修正完了。バックアップは .bak 拡張子で保存されました。"
