# docs/testing/unit-tests.md

> **遵守バッジ** : :no_entry: 実装コード非出力 / :no_entry_sign: C/C++依存禁止

## 目次
- [目的](#目的)
- [テスト戦略](#テスト戦略)
- [テストピラミッド](#テストピラミッド)
- [フィクスチャとモック方針](#フィクスチャとモック方針)
- [プロパティテスト](#プロパティテスト)
- [フェイルケース設計](#フェイルケース設計)
- [カバレッジ目標](#カバレッジ目標)
- [実行と自動化](#実行と自動化)
- [関連ドキュメント](#関連ドキュメント)

## 目的
Nyxの単体テストの方針を定義し、最小単位での品質を保証する。

## テスト戦略
- 機能モジュールごとのテストと契約を明確化。
- セキュアストリーム、ミックスルーティング、オブフスケーション、暗号の単体テストを重点。
- 実装言語に依存せず、仕様準拠テストケースを定義。

## テストピラミッド
```
        ┌───────────────┐
        │ E2E (軽)       │ 10%
        ├───────────────┤
        │ 統合テスト     │ 30%
        ├───────────────┤
        │ 単体テスト     │ 60%
        └───────────────┘
```
- 単体テストが基盤、統合/ E2E は補完。

## フィクスチャとモック方針
- **暗号**: 擬似鍵生成器を使用し、実鍵は使用しない。
- **ネットワーク**: 抽象インターフェースをモック、C/C++依存なく実現。
- **コンフィグ**: テスト専用の設定ファイル (YAML/JSON)。

## プロパティテスト
- 入出力不変条件 (例: 再暗号化後の復号で元のデータが得られる)。
- ルーティング多様性: ノードセットが一定以上のエントロピーを持つ。
- 指定範囲: 乱数、Poisson λ 。

## フェイルケース設計
- 0-RTT失敗時のリトライ動作。
- FEC過剰時のアダプティブ制御。
- 監査ログ書き込み失敗時のフォールバック。

## カバレッジ目標
| カテゴリ | 目標 |
|----------|------|
| ステートメント | 85% |
| ブランチ | 75% |
| プロパティ | 15シナリオ以上 |
- カバレッジ報告はCIで自動収集。

## 実行と自動化
- 単体テストはコミット毎に実行。
- 失敗時は即時ブロック。
- レポートは[testing/metrics.md](./metrics.md)で集約。

## 関連ドキュメント
- [testing/integration-tests.md](./integration-tests.md)
- [testing/e2e-tests.md](./e2e-tests.md)
- [templates/test-template.md](../templates/test-template.md)

> **宣言**: 実装コード無し、C/C++依存無し。