# docs/performance/benchmark.md

> **遵守バッジ** : :no_entry: 実装コード非出力 / :no_entry_sign: C/C++依存禁止

## 目次
- [目的](#目的)
- [テスト対象とシナリオ](#テスト対象とシナリオ)
- [負荷テスト計画](#負荷テスト計画)
- [ストレステスト計画](#ストレステスト計画)
- [耐障害テスト計画](#耐障害テスト計画)
- [測定と可観測性](#測定と可観測性)
- [合否基準](#合否基準)
- [実行サイクル](#実行サイクル)
- [関連ドキュメント](#関連ドキュメント)

## 目的
Nyxの性能検証戦略を定義し、負荷/ストレス/耐障害テストを体系化してSLO達成を確認する。

## テスト対象とシナリオ
| シナリオID | 説明 | 重点指標 |
|------------|------|----------|
| BENCH-01 | 0-RTTセッション確立を高並列で実行 | 接続成功率、レイテンシ |
| BENCH-02 | 長時間セッションの継続通信 | スループット、FEC効果 |
| BENCH-03 | モバイルハンドオーバ | 再接続時間、データ損失 |
| BENCH-04 | 監査ログ大量出力 | 書き込みレイテンシ |

## 負荷テスト計画
- **ツール**: k6/Python locust等のC依存無しのツール。
- **パラメータ**: ユーザ数、ランプアップ速度、テスト継続時間。
- **データセット**: 合成データ + 匿名化実データ。
- **前提**: テスト環境は本番相当構成 (スケール縮小版)。

## ストレステスト計画
- **目標**: 限界閾値を特定し、優雅な劣化を確認。
- 方法: トラフィック急増、ノード削減、暗号スイート切替。
- 計測: エラーレート、バックプレッシャ指標、λ適応。

## 耐障害テスト計画
- **Chaos実験**: Mixノード停止、リンク遅延挿入、KMS不達。
- **復旧目標**: 重要サービス復旧 < 5分。
- **検証**: [deployment/rollback.md](../deployment/rollback.md)の手順適用。

## 測定と可観測性
- SLI収集: Latency、Error率、Cover Traffic適合、PQネゴ成功率。
- トレース: OpenTelemetryでエンドツーエンド可視化。
- ログ: 解析のため匿名化。計測は[testing/metrics.md](../testing/metrics.md)へ連携。

## 合否基準
| 指標 | 合格ライン | 備考 |
|------|-------------|------|
| 接続成功率 | 99.5% 以上 | BENCH-01 |
| P95遅延 | 350ms以下 | BENCH-02 |
| モバイル再接続 | 2秒以下 | BENCH-03 |
| 監査ログ遅延 | 1秒以下 | BENCH-04 |
| エラー率 | 0.1%以下 | 全般 |

## 実行サイクル
- スプリント毎にSmokeベンチ。
- マイルストーン前に総合テスト。
- 結果は[notes/meeting-notes.md](../notes/meeting-notes.md)で報告し、[notes/decision-log.md](../notes/decision-log.md)で対策を記録。

## 関連ドキュメント
- [performance/scalability.md](./scalability.md)
- [architecture/dataflow.md](../architecture/dataflow.md)
- [testing/metrics.md](../testing/metrics.md)

> **宣言**: 実装コード無し、C/C++依存無し。